# æ•°æ®åº“æŸ¥çœ‹æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

SecureChat ç³»ç»Ÿä½¿ç”¨ **SQLite3** æ•°æ®åº“æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’ŒåŠ å¯†æ¶ˆæ¯ã€‚æ•°æ®åº“æ–‡ä»¶ä½äºï¼š
```
/home/lyanta/secureChat/secure-chat-system/server/database.db
```

## ğŸ” æŸ¥çœ‹æ•°æ®åº“çš„æ–¹æ³•

### æ–¹æ³• 1ï¼šä½¿ç”¨è‡ªå®šä¹‰æŸ¥çœ‹å·¥å…·ï¼ˆæ¨èï¼‰

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä¸“é—¨çš„ Node.js å·¥å…·æ¥æŸ¥çœ‹æ•°æ®åº“å†…å®¹ã€‚

#### åŸºæœ¬ä½¿ç”¨

```bash
# è¿›å…¥ server ç›®å½•
cd /home/lyanta/secureChat/secure-chat-system/server

# æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ã€ç”¨æˆ·åˆ—è¡¨å’Œæœ€è¿‘20æ¡æ¶ˆæ¯
node view-messages.js
```

#### é«˜çº§ç”¨æ³•

```bash
# 1. æŸ¥çœ‹æ‰€æœ‰æ¶ˆæ¯ï¼ˆé»˜è®¤100æ¡ï¼‰
node view-messages.js --all

# 2. æŸ¥çœ‹æŒ‡å®šæ•°é‡çš„æ¶ˆæ¯
node view-messages.js --all 50

# 3. åªæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
node view-messages.js --users

# 4. åªæŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
node view-messages.js --stats

# 5. æŸ¥çœ‹ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„å¯¹è¯
node view-messages.js --chat <ç”¨æˆ·ID1> <ç”¨æˆ·ID2>
# ç¤ºä¾‹ï¼šæŸ¥çœ‹ç”¨æˆ·1å’Œç”¨æˆ·2çš„å¯¹è¯
node view-messages.js --chat 1 2

# 6. æŸ¥çœ‹å•æ¡æ¶ˆæ¯çš„å®Œæ•´å†…å®¹
node view-messages.js --message <æ¶ˆæ¯ID>
# ç¤ºä¾‹ï¼šæŸ¥çœ‹æ¶ˆæ¯#5çš„å®Œæ•´å†…å®¹
node view-messages.js --message 5

# 7. æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
node view-messages.js --help
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ SQLite3 å‘½ä»¤è¡Œå·¥å…·

å¦‚æœä½ æƒ³ä½¿ç”¨åŸç”Ÿçš„ SQLite å·¥å…·ï¼Œéœ€è¦å…ˆå®‰è£…ï¼š

```bash
# å®‰è£… sqlite3 å‘½ä»¤è¡Œå·¥å…·
sudo apt install sqlite3

# è¿›å…¥æ•°æ®åº“
cd /home/lyanta/secureChat/secure-chat-system/server
sqlite3 database.db
```

å¸¸ç”¨ SQL æŸ¥è¯¢ï¼š

```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
.tables

-- æŸ¥çœ‹è¡¨ç»“æ„
.schema users
.schema messages
.schema sessions

-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
SELECT * FROM users;

-- æŸ¥çœ‹æ‰€æœ‰æ¶ˆæ¯
SELECT 
  m.id,
  u1.username as å‘é€è€…,
  u2.username as æ¥æ”¶è€…,
  m.encrypted_content as åŠ å¯†å†…å®¹,
  m.created_at as æ—¶é—´
FROM messages m
JOIN users u1 ON m.from_user_id = u1.id
JOIN users u2 ON m.to_user_id = u2.id
ORDER BY m.created_at DESC;

-- æŸ¥çœ‹ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„å¯¹è¯
SELECT 
  u1.username as å‘é€è€…,
  u2.username as æ¥æ”¶è€…,
  m.encrypted_content,
  m.created_at
FROM messages m
JOIN users u1 ON m.from_user_id = u1.id
JOIN users u2 ON m.to_user_id = u2.id
WHERE (m.from_user_id = 1 AND m.to_user_id = 2) 
   OR (m.from_user_id = 2 AND m.to_user_id = 1)
ORDER BY m.created_at ASC;

-- é€€å‡º
.quit
```

### æ–¹æ³• 3ï¼šä½¿ç”¨å›¾å½¢åŒ–å·¥å…·

æ¨èä½¿ç”¨ **DB Browser for SQLite**ï¼š

```bash
# å®‰è£…
sudo apt install sqlitebrowser

# æ‰“å¼€æ•°æ®åº“
sqlitebrowser /home/lyanta/secureChat/secure-chat-system/server/database.db
```

æˆ–è€…ä½¿ç”¨åœ¨çº¿å·¥å…·ï¼š
- SQLite Viewer (https://sqliteviewer.app/)
- SQLite Online (https://sqliteonline.com/)

## ğŸ“Š æ•°æ®åº“ç»“æ„

### users è¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰ |
| username | TEXT | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| password_hash | TEXT | å¯†ç å“ˆå¸Œå€¼ |
| public_key | TEXT | RSAå…¬é’¥ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### messages è¡¨ï¼ˆæ¶ˆæ¯è¡¨ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | æ¶ˆæ¯IDï¼ˆä¸»é”®ï¼‰ |
| from_user_id | INTEGER | å‘é€è€…ID |
| to_user_id | INTEGER | æ¥æ”¶è€…ID |
| encrypted_content | TEXT | åŠ å¯†æ¶ˆæ¯å†…å®¹ |
| iv | TEXT | AESåŠ å¯†çš„åˆå§‹åŒ–å‘é‡ |
| created_at | DATETIME | å‘é€æ—¶é—´ |

### sessions è¡¨ï¼ˆä¼šè¯è¡¨ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| token | TEXT | ä¼šè¯ä»¤ç‰Œï¼ˆä¸»é”®ï¼‰ |
| user_id | INTEGER | ç”¨æˆ·ID |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| expires_at | DATETIME | è¿‡æœŸæ—¶é—´ |

## ğŸ” å…³äºåŠ å¯†

**é‡è¦æç¤º**ï¼šæ•°æ®åº“ä¸­å­˜å‚¨çš„æ¶ˆæ¯å†…å®¹æ˜¯**åŠ å¯†çš„**ï¼

- æ—©æœŸæ¶ˆæ¯ï¼ˆæ²¡æœ‰IVçš„ï¼‰å¯èƒ½æ˜¯æ˜æ–‡æµ‹è¯•æ¶ˆæ¯
- åæœŸæ¶ˆæ¯éƒ½ç»è¿‡ **AES-256-GCM** åŠ å¯†
- æ¯æ¡æ¶ˆæ¯éƒ½æœ‰å¯¹åº”çš„ **IVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰**
- è§£å¯†éœ€è¦ç›¸åº”çš„ **AES å¯†é’¥**ï¼Œå¯†é’¥å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨çš„ localStorage ä¸­
- æœåŠ¡å™¨ç«¯**æ— æ³•è§£å¯†**æ¶ˆæ¯å†…å®¹ï¼ˆç«¯åˆ°ç«¯åŠ å¯†ï¼‰

## ğŸ’¡ å®ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæŸ¥çœ‹å½“å‰æœ‰å¤šå°‘ç”¨æˆ·å’Œæ¶ˆæ¯
```bash
node view-messages.js --stats
```

### ç¤ºä¾‹2ï¼šæŸ¥çœ‹æœ€è¿‘50æ¡æ¶ˆæ¯
```bash
node view-messages.js --all 50
```

### ç¤ºä¾‹3ï¼šæŸ¥çœ‹ google1 å’Œ google2 çš„èŠå¤©è®°å½•
```bash
# é¦–å…ˆæŸ¥çœ‹ç”¨æˆ·ID
node view-messages.js --users

# å‡è®¾ google1 çš„IDæ˜¯7ï¼Œgoogle2 çš„IDæ˜¯8
node view-messages.js --chat 7 8
```

### ç¤ºä¾‹4ï¼šæŸ¥çœ‹æŸæ¡æ¶ˆæ¯çš„å®Œæ•´åŠ å¯†å†…å®¹
```bash
node view-messages.js --message 27
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°æ•°æ®åº“æ–‡ä»¶
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿æœåŠ¡å™¨è‡³å°‘å¯åŠ¨è¿‡ä¸€æ¬¡ï¼Œæ•°æ®åº“æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºã€‚

### é—®é¢˜2ï¼šæç¤º"æ•°æ®åº“è¢«é”å®š"
**è§£å†³æ–¹æ¡ˆ**ï¼šå…³é—­æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨ï¼Œæˆ–ä½¿ç”¨åªè¯»æ¨¡å¼æŸ¥çœ‹ã€‚

### é—®é¢˜3ï¼šçœ‹ä¸åˆ°æ¶ˆæ¯å†…å®¹
**è§£å†³æ–¹æ¡ˆ**ï¼šæ¶ˆæ¯æ˜¯åŠ å¯†çš„ï¼Œä½ çœ‹åˆ°çš„æ˜¯å¯†æ–‡ã€‚åªæœ‰åœ¨æµè§ˆå™¨å®¢æˆ·ç«¯æ‰èƒ½çœ‹åˆ°è§£å¯†åçš„æ˜æ–‡ã€‚

## ğŸ“ å¿«é€Ÿå‚è€ƒ

åˆ›å»ºåˆ«åæ–¹ä¾¿ä½¿ç”¨ï¼š

```bash
# æ·»åŠ åˆ° ~/.bashrc
alias view-chat='cd /home/lyanta/secureChat/secure-chat-system/server && node view-messages.js'

# é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc

# ç„¶åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨
view-chat
view-chat --users
view-chat --chat 1 2
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ¶æ„è¯´æ˜](./æ¶æ„æ•´ç†è¯´æ˜.md)
- [ä½¿ç”¨æŒ‡å—](./USAGE_GUIDE.md)
- [é¡¹ç›®è®¡åˆ’](./PROJECT_PLAN.md)

